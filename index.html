<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FCS AI Generator Suite</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<style>
  :root { --bg:#ffffff; --fg:#111; --muted:#666; --border:#d0d0d0; --accent:#0057d9; --primary-blue:#0b5cff; }
  body { background: var(--light-gray-bg, #f8f9fa); color: var(--fg); font-family: Calibri, Arial, sans-serif; font-size: 15px; margin:0; }
  .fcs-wrap { max-width: 980px; margin: 28px auto; padding: 0 16px; }
  h1 { font-size: 28px; font-weight:700; text-align:center; margin-bottom: 28px;}
  h2 { font-size: 20px; font-weight:700; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
  .fcs-card { border:1px solid var(--border); border-radius: 12px; padding: 24px; background:#fff; margin-bottom: 20px; }
  label { font-weight: 600; font-size: 14px; display: block; margin-bottom: 6px; }
  input[type="text"], select, input[type="number"], textarea { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: #fff; font-size:15px; box-sizing:border-box; }
  input:disabled { background-color: #f8f9fa; }
  .hint, .small { font-size: 12px; color: var(--muted); margin-top: 4px; }
  button { padding: 10px 16px; border-radius: 8px; border:1px solid var(--border); background:#f6f8fb; cursor: pointer; font-weight: 600; font-size:15px; transition: all 0.2s; }
  button.primary { background: var(--primary-blue); color: #fff; border-color: var(--primary-blue); }
  button:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  button:disabled { cursor: not-allowed; opacity: 0.6; }
  .fcs-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
  .fcs-tab-btn { flex-grow: 1; text-align: center; } .fcs-generator { display: none; } .fcs-generator.active { display: block; }
  .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px; align-items: end; }
  .six { grid-column: span 6; } .twelve { grid-column: span 12; }
  .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; } .grid-full { grid-column: 1 / -1; }
  .actions { display: flex; gap: 10px; flex-wrap: wrap; margin-top:20px; }
  .status { margin-top:10px; min-height:1.5em; text-align:left; color:var(--muted); font-size:13px; }
  .output-container { border:1px solid var(--border); border-radius:12px; padding:24px; background:#fdfdfd; min-height: 200px; margin-top:20px; }
  .output-container h1 { font-size: 20px; }
  /* --- FIX FOR WHITE HEADERS --- */
  .output-container h1, .output-container h2 { text-align: center; color: #000 !important; }
  .output-container h2 { font-size: 18px; border: none; margin-top:24px; background: #f0f0f0; padding:8px; border-radius: 5px; }
  .output-container table { width:100%; border-collapse: collapse; margin-top: 12px; font-size:10pt;}
  .output-container th, .output-container td { border:1px solid #ccc; padding:6px; vertical-align:top; } .output-container th { background: #f4f4f4; }
  .output-container .en { color: #0057d9; font-weight: bold; } .output-container .es { color: #c00000; font-weight: bold; }
  .output-container .ans-en { color: #0057d9; font-style: italic; } .output-container .ans-es { color: #c00000; font-style: italic; }
  .output-container .subcategory td { background: #e0e0e0; font-weight: bold; text-align: left; }
  @media (max-width: 860px){ .six, .twelve { grid-column: span 12; } .grid-2{grid-template-columns:1fr;} }
</style>
</head>
<body>
<div class="fcs-wrap">
    <h1>FCS AI GENERATOR SUITE</h1>
    <div class="fcs-tabs">
        <button id="tab-vocab" class="fcs-tab-btn primary">Vocabulary</button>
        <button id="tab-convo" class="fcs-tab-btn">Conversation</button>
        <button id="tab-test" class="fcs-tab-btn">Test</button>
    </div>

    <!-- ===== VOCABULARY GENERATOR ===== -->
    <div id="gen-vocab" class="fcs-generator active">
        <div class="fcs-card">
            <h2>Vocabulary Creator</h2>
            <div class="grid">
              <div class="six"><label for="v-topic">Topic</label><input id="v-topic" type="text" value="At the Airport"></div>
              <div class="six"><label for="v-level">Level</label><select id="v-level"><option value="1">Level 1 — Survival</option><option value="2">Level 2 — Beginner</option><option value="3" selected>Level 3 — Intermediate</option><option value="4">Level 4 — Conversational</option><option value="5">Level 5 — Fluent</option></select></div>
              <div class="six"><label for="v-tmode">Total Words Mode</label><select id="v-tmode"><option value="default" selected>Preset by Level</option><option value="custom">Custom</option></select><div id="v-presetText" class="hint"></div></div>
              <div class="six"><div class="grid"><div class="six"><label for="v-tmin">Min</label><input id="v-tmin" type="number" min="1" disabled></div><div class="six"><label for="v-tmax">Max</label><input id="v-tmax" type="number" min="1" disabled></div></div></div>
              <div class="twelve"><label for="v-vocab-include">Vocabulary to Include (optional)</label><textarea id="v-vocab-include" rows="3" placeholder="Paste a full or partial list of words to include..."></textarea></div>
            </div>
            <div class="actions"><button id="v-gen" class="primary">Generate Vocabulary</button><button id="v-excel">Download Excel</button><button id="v-copy">Copy</button><div id="v-status" class="status"></div></div>
        </div>
        <div id="v-output" class="output-container"><p>Your vocabulary list will appear here...</p></div>
    </div>

    <!-- Other Generators (unchanged from working version) -->
    <div id="gen-convo" class="fcs-generator"><!-- ... --></div>
    <div id="gen-test" class="fcs-generator"><!-- ... --></div>
</div>

<script>
"use strict";
(function(){
    const $ = (id) => document.getElementById(id);
    const API_URL = "/api/index"; 

    // --- Tab Switching & Core AI Call ---
    (function initTabs(){ /* unchanged */ })();
    async function generateResult(prompt, buttonEl, statusEl, outputEl) { /* unchanged */ }

    // --- VOCABULARY GENERATOR ---
    (function setupVocab(){
        const genBtn=$('v-gen'),excelBtn=$('v-excel'),copyBtn=$('v-copy'),statusEl=$('v-status'),outputEl=$('v-output'),levelEl=$("v-level"),tmodeEl=$("v-tmode"),tminEl=$("v-tmin"),tmaxEl=$("v-tmax"),presetTextEl=$("v-presetText"),topicEl=$("v-topic"),vocabIncludeEl=$("v-vocab-include");
        const presetRanges={"1":{min:35,max:55},"2":{min:60,max:85},"3":{min:90,max:120},"4":{min:120,max:180},"5":{min:160,max:240}};
        const levelTexts={"1":"Level 1—Survival","2":"Level 2—Beginner","3":"Level 3—Intermediate","4":"Level 4—Conversational","5":"Level 5—Fluent"};
        
        function updateUI(){
            const isCustom=tmodeEl.value==='custom'; const range=presetRanges[levelEl.value];
            tminEl.disabled=!isCustom; tmaxEl.disabled=!isCustom;
            if(!isCustom){tminEl.value=range.min;tmaxEl.value=range.max;}
            presetTextEl.textContent=`Preset for ${levelTexts[levelEl.value]}: ${range.min}–${range.max} words.`;
        }
        tmodeEl.addEventListener('change',updateUI); levelEl.addEventListener('change',updateUI);
        
        genBtn.addEventListener('click', () => {
            if(!topicEl.value.trim()){statusEl.textContent="Please enter a topic.";return;}
            
            // This is the new, highly detailed prompt that implements your rules
            const promptLines = [
                "OUTPUT CONTRACT: You MUST respond with a single, complete HTML file with embedded styles. Do not include markdown or any commentary. The output MUST be ready to display directly in a browser.",
                "STYLE RULES:",
                "- Font: Calibri, size 10pt.",
                "- Colors: English is bold blue (<span class=\"en\">), Spanish is bold red (<span class=\"es\">).",
                "- Question Answers: Use .ans-en and .ans-es for italics.",
                "- Headings: <h1> for the main title, <h2> for sections, all centered.",
                "- Tables: Use standard HTML tables (<table>) with borders and padding.",
                "GENERATION LOGIC (NON-NEGOTIABLE):",
                "1.  **Section Order**: Nouns (with subcategories), Verbs, Descriptive Words, Common Phrases, Common Questions. You MUST include all sections.",
                "2.  **Word Counts by Level**: Adhere STRICTLY to these ranges for each section:",
                "    - Level 1: Nouns <= 35, Verbs <= 15, Descriptive <= 12, Questions <= 8, Phrases <= 12.",
                "    - Level 2: Nouns 30-55, Verbs 12-20, Descriptive 10-18, Questions 7-12, Phrases 10-18.",
                "    - Level 3: Nouns 50-75, Verbs 18-30, Descriptive 18-28, Questions 12-18, Phrases 15-25.",
                "    - Level 4: Nouns >= 70, Verbs >= 25, Descriptive >= 25, Questions >= 18, Phrases >= 25.",
                "    - Level 5: Nouns >= 90, Verbs >= 30, Descriptive >= 30, Questions >= 25, Phrases >= 35.",
                "3.  **Total Words**: Honor the Total Min/Max. 'Total Words' counts ONLY Nouns + Verbs + Descriptive Words. Adjust section counts proportionally to meet the total.",
                "4.  **Sentence Structure Rules**:",
                "    - Nouns: Full sentences (e.g., 'Here is the <span class=\"en\">airplane</span>.' / 'Aquí está el <span class=\"es\">avión</span>.'). Use natural variations like 'This is...' if more appropriate.",
                "    - Verbs: Full sentences (e.g., 'I am going to <span class=\"en\">fly</span>...' / 'Yo voy a <span class=\"es\">volar</span>...'). Use nouns from this lesson.",
                "    - Descriptive Words: Full sentences using ser/estar.",
                "5.  **Spanish Gender Rule**: English side shows masculine only. Spanish side shows masculine, with feminine in parentheses if applicable (e.g., 'el <span class=\"es\">pasajero</span> (la <span class=\"es\">pasajera</span>)').",
                "6.  **Alphabetization**: ALL sections and subcategories MUST be alphabetized by the English term.",
                "7.  **Labels**: Start each section with an in-table label row (e.g., <tr><td class=\"subcategory\" colspan=\"2\">Nouns / Sustantivos</td></tr>).",
                "",
                "--- USER INPUT ---",
                `Topic: ${topicEl.value}`,
                `Level: ${levelEl.value}`,
                `Total Words Mode: ${tmodeEl.value}`,
                `Min Words: ${tminEl.value}`,
                `Max Words: ${tmaxEl.value}`,
                `Vocabulary to Include: ${vocabIncludeEl.value || 'None'}`
            ];
            const prompt = promptLines.join('\n');
            generateResult(prompt, genBtn, statusEl, outputEl);
        });
        
        copyBtn.addEventListener('click',()=>copyToClipboard(outputEl,statusEl));
        excelBtn.addEventListener('click', () => generateVocabExcel(outputEl, statusEl, topicEl.value, levelEl.value));
        updateUI();
    })();

    // Initialize all other generators with their UI
    // (Pasting in their full code to avoid breaking references)
    (function setupFullUI(){
        (function initTabs(){
            const tabs=document.querySelectorAll('.fcs-tab-btn'),gens=document.querySelectorAll('.fcs-generator');
            tabs.forEach(tab=>{tab.addEventListener('click',()=>{const t=tab.id.replace('tab-','gen-');tabs.forEach(t=>t.classList.remove('primary'));tab.classList.add('primary');gens.forEach(g=>{g.style.display=g.id===t?'block':'none';})})});
        })();

        async function generateResult(prompt, buttonEl, statusEl, outputEl){
            buttonEl.disabled=true; statusEl.textContent="Generating... This may take up to a minute.";
            outputEl.innerHTML="<h4>Please wait. The AI is crafting your content...</h4>";
            try {
                const response=await fetch(API_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:prompt})});
                const result=await response.json();
                if(!response.ok)throw new Error(result.details||result.error||"An unknown server error.");
                outputEl.innerHTML = result.content;
                statusEl.textContent="Generation successful!";
            } catch(error){console.error("Error:",error);outputEl.innerHTML=`<p style="color:red;"><strong>Error:</strong> Failed to generate content. Details: ${error.message}</p>`;statusEl.textContent="An error occurred.";}
            finally{buttonEl.disabled=false;}
        }

        function copyToClipboard(outputEl,statusEl){if(!outputEl.innerHTML||outputEl.innerText.includes("will appear here")){statusEl.textContent="Nothing to copy.";return}navigator.clipboard.writeText(outputEl.innerHTML).then(()=>statusEl.textContent="Copied!",()=>statusEl.textContent="Copy failed.")}
        function generateVocabExcel(outputEl, statusEl, topic, level){
            if (!outputEl.querySelector('table')) { statusEl.textContent = "No data to export."; return; }
            const table = outputEl.querySelector('table');
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.table_to_sheet(table);
            XLSX.utils.book_append_sheet(wb, ws, "Vocabulary");
            XLSX.writeFile(wb, `${topic}_L${level}_Vocab.xlsx`);
            statusEl.textContent = "Excel download started.";
        }
        
        (function setupConvo(){
            const ui=`<h2>Conversation Creator</h2><div class="grid-2"><div class="grid-full"><label>Topic</label><input id="c-topic" type="text"/></div><div><label>Level</label><select id="c-level"><option value="1">Level 1</option><option value="2" selected>Level 2</option><option value="3">Level 3</option><option value="4">Level 4</option><option value="5">Level 5</option></select></div><div><label>Tone</label><select id="c-tone"><option>Neutral, casual</option><option>Informal, friendly</option></select></div><div class="grid-full"><label>Vocabulary (Optional)</label><textarea id="c-vocab" rows="4"></textarea></div><div><label># Convos</label><input id="c-numConvos" type="number" value="1"/></div><div><label># Speakers</label><input id="c-numSpeakers" type="number" value="2"/></div><div><label>Add Fill-In-The-Blank?</label><select id="c-addFib"><option value="no">No</option><option value="yes" selected>Yes</option></select></div><div><label>FIB Focus</label><select id="c-fibFocus"><option>Mixed</option><option>Verbs only</option></select></div></div><div class="actions"><button id="c-gen" class="primary">Generate</button><button id="c-copy">Copy</button><div id="c-status" class="status"></div></div>`;
            $('gen-convo').innerHTML=`<div class="fcs-card">${ui}</div><div id="c-output" class="output-container"><p>Your conversation will appear here...</p></div>`;
            $('c-gen').addEventListener('click', ()=>{
                if(!$('c-topic').value.trim()){$('c-status').textContent="Please enter a topic.";return;}
                const prompt=`OUTPUT CONTRACT: Create an HTML file based on the FCS CONVERSATION CREATOR rules. Key Rules: Return ONLY raw HTML. Format in two columns. Bold and color vocab. Use ________ (ENGLISH) for blanks. \n\n---\nUSER INPUT:\nTopic: ${$('c-topic').value}\nLevel: ${$('c-level').value}\nVocab: ${$('c-vocab').value||"auto"}\nNum Convos: ${$('c-numConvos').value}\nNum Speakers: ${$('c-numSpeakers').value}\nAdd FIB: ${$('c-addFib').value}\nFIB Focus: ${$('c-fibFocus').value}\nTone: ${$('c-tone').value}`;
                generateResult(prompt, $('c-gen'), $('c-status'), $('c-output'));
            });
            $('c-copy').addEventListener('click',()=>copyToClipboard($('c-output'),$('c-status')));
        })();

        (function setupTest(){
            const ui=`<h2>Test Creator</h2><div><label for="t-vocab">Vocabulary List</label><textarea id="t-vocab" rows="6" placeholder="Paste vocab..."></textarea></div><div><label for="t-level">Level</label><select id="t-level"><option value="1">Level 1</option><option value="2" selected>Level 2</option><option value="3">Level 3</option><option value="4">Level 4</option><option value="5">Level 5</option></select></div><div><label><input type="checkbox" id="t-anskeys" checked> Include Answer Keys?</label></div><div class="actions"><button id="t-gen" class="primary">Generate</button><button id="t-copy">Copy</button><div id="t-status" class="status"></div></div>`;
            $('gen-test').innerHTML=`<div class="fcs-card">${ui}</div><div id="t-output" class="output-container"><p>Your test will appear here...</p></div>`;
            $('t-gen').addEventListener('click', ()=>{
                if(!$('t-vocab').value.trim()){$('t-status').textContent="Please paste a vocab list.";return;}
                const prompt=`OUTPUT CONTRACT: Create a 3-part Spanish test as a single HTML file. Follow all rules from the FCS TEST CREATOR documentation. Key Rules: Return ONLY raw HTML. Structure: Part 1 (ES->EN), Part 2 (EN->ES), Part 3 (Oral Prompts). Use ONLY provided vocab and level-grammar. \n\n---\nUSER INPUT:\nLevel: ${$('t-level').value}\nInclude Keys: ${$('t-anskeys').checked}\nVocab List:\n${$('t-vocab').value}`;
                generateResult(prompt, $('t-gen'), $('t-status'), $('t-output'));
            });
            $('t-copy').addEventListener('click',()=>copyToClipboard($('t-output'),$('t-status')));
        })();
    })();
</script>

</body>
</html>
