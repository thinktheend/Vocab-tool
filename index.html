<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FCS AI Generator Suite</title>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
  :root { --bg:#ffffff; --fg:#111; --muted:#666; --border:#d0d0d0; --accent:#0057d9; --primary-blue:#0b5cff; }
  body { background: var(--light-gray-bg, #f8f9fa); color: var(--fg); font-family: Calibri, Arial, sans-serif; font-size: 15px; margin:0; }
  .fcs-wrap { max-width: 980px; margin: 28px auto; padding: 0 16px; }
  h1 { font-size: 28px; font-weight:700; text-align:center; margin-bottom: 28px;}
  h2 { font-size: 20px; font-weight:700; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
  .fcs-card { border:1px solid var(--border); border-radius: 12px; padding: 24px; background:#fff; margin-bottom: 20px; }
  label { font-weight: 600; font-size: 14px; display: block; margin-bottom: 6px; }
  input[type="text"], select, input[type="number"], textarea { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; background: #fff; font-size:15px; box-sizing:border-box; }
  input:disabled { background-color: #f8f9fa; }
  .hint, .small { font-size: 12px; color: var(--muted); margin-top: 4px; }
  button { padding: 10px 16px; border-radius: 8px; border:1px solid var(--border); background:#f6f8fb; cursor: pointer; font-weight: 600; font-size:15px; transition: all 0.2s; }
  button.primary { background: var(--primary-blue); color: #fff; border-color: var(--primary-blue); }
  button:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  button:disabled { cursor: not-allowed; opacity: 0.6; }
  .fcs-tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
  .fcs-tab-btn { flex-grow: 1; text-align: center; } .fcs-generator { display: none; } .fcs-generator.active { display: block; }
  .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px; align-items: end; }
  .six { grid-column: span 6; } .twelve { grid-column: span 12; }
  .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; } .grid-full { grid-column: 1 / -1; }
  .actions { display: flex; gap: 10px; flex-wrap: wrap; margin-top:20px; }
  .status { margin-top:10px; min-height:1.5em; text-align:left; color:var(--muted); font-size:13px; }
  .output-container { border:1px solid var(--border); border-radius:12px; padding:24px; background:#fdfdfd; min-height: 200px; margin-top:20px; }
  /* Output Styles for direct HTML render */
  .output-container h1, .output-container h2 { text-align: center; } .output-container .note { font-size: 9pt; color: #666; text-align:center; }
  .output-container table { width:100%; border-collapse: collapse; margin-top: 12px; font-size:10pt;}
  .output-container th, .output-container td { border:1px solid #ccc; padding:6px; vertical-align:top; } .output-container th { background: #f4f4f4; }
  .output-container .en { color: #0057d9; font-weight: bold; } .output-container .es { color: #c00000; font-weight: bold; }
  .output-container .ans-en { color: #0057d9; font-style: italic; } .output-container .ans-es { color: #c00000; font-style: italic; }
  .output-container .subcategory { background: #e0e0e0; font-weight: bold; text-align: left; }
  .output-container .spacer { height:12px; background:#fff; border:none; }
  .output-container p b, .output-container p strong { font-weight: 900; } /* Make sure bold tags are respected */

  @media (max-width: 860px){ .six, .twelve { grid-column: span 12; } .grid-2{grid-template-columns:1fr;} }
</style>
</head>
<body>
<div class="fcs-wrap">
    <h1>FCS AI GENERATOR SUITE</h1>
    <div class="fcs-tabs">
        <button id="tab-vocab" class="fcs-tab-btn primary">Vocabulary</button>
        <button id="tab-convo" class="fcs-tab-btn">Conversation</button>
        <button id="tab-test" class="fcs-tab-btn">Test</button>
    </div>

    <!-- ===== VOCABULARY GENERATOR (from vocab.html) ===== -->
    <div id="gen-vocab" class="fcs-generator active">
        <div class="fcs-card">
            <div class="grid">
              <div class="six"><label for="v-topic">Topic</label><input id="v-topic" type="text" placeholder="e.g., camping, dance" value="At the Airport"></div>
              <div class="six"><label for="v-level">Level</label><select id="v-level"><option value="1">Level 1 — Survival</option><option value="2">Level 2 — Beginner</option><option value="3" selected>Level 3 — Intermediate</option><option value="4">Level 4 — Conversational</option><option value="5">Level 5 — Fluent</option></select></div>
              <div class="six"><label for="v-tmode">Total Words Mode</label><select id="v-tmode"><option value="default" selected>Preset by Level</option><option value="custom">Custom (enable inputs)</option></select><div id="v-presetText" class="preset-line"></div><div class="hint">Counts Nouns + Verbs + Descriptive Words.</div></div>
              <div class="six"><div class="grid"><div class="six"><label for="v-tmin">Total Min</label><input id="v-tmin" type="number" min="1" disabled></div><div class="six"><label for="v-tmax">Total Max</label><input id="v-tmax" type="number" min="1" disabled></div></div></div>
            </div>
            <div class="actions"><button id="v-gen" class="primary">Generate Vocabulary</button><button id="v-copy">Copy HTML</button><div id="v-status" class="status"></div></div>
        </div>
        <div id="v-output" class="output-container"><p>Your generated vocabulary list will appear here...</p></div>
    </div>

    <!-- ===== CONVERSATION GENERATOR (from convo.html) ===== -->
    <div id="gen-convo" class="fcs-generator">
        <div class="fcs-card">
            <div class="grid-2">
              <div class="grid-full"><label>Topic</label><input id="c-topic" placeholder="e.g., about the game, with a friend" type="text"/></div>
              <div><label>Level (Grammar)</label><select id="c-level"><option value="1">Level 1</option><option value="2" selected>Level 2</option><option value="3">Level 3</option><option value="4">Level 4</option><option value="5">Level 5</option></select></div>
              <div><label>Tone</label><select id="c-tone"><option>Neutral, casual</option><option>Informal, friendly</option></select></div>
              <div class="grid-full"><label>Vocabulary (paste list, or leave blank)</label><textarea id="c-vocab" rows="4"></textarea></div>
              <div><label># Convos</label><input id="c-numConvos" type="number" value="1"/></div>
              <div><label># Speakers</label><input id="c-numSpeakers" type="number" value="2"/></div>
              <div><label>Add Fill-In-The-Blank?</label><select id="c-addFib"><option value="no">No</option><option value="yes" selected>Yes</option></select></div>
              <div><label>Fill‑in‑the‑Blank Focus</label><select id="c-fibFocus"><option>Mixed</option><option>Vocab only</option><option>Verbs only</option></select></div>
            </div>
            <div class="actions"><button id="c-gen" class="primary">Generate Conversation</button><button id="c-copy">Copy HTML</button><div id="c-status" class="status"></div></div>
        </div>
        <div id="c-output" class="output-container"><p>Your generated conversation will appear here...</p></div>
    </div>
    
    <!-- ===== TEST GENERATOR (from test.html) ===== -->
    <div id="gen-test" class="fcs-generator">
        <div class="fcs-card">
            <div><label for="t-vocab">Vocabulary List</label><textarea id="t-vocab" rows="6" placeholder="Paste the EXACT vocabulary for the topic..."></textarea></div>
            <div><label for="t-level">Level (Grammar)</label><select id="t-level"><option value="1">Level 1</option><option value="2" selected>Level 2</option><option value="3">Level 3</option><option value="4">Level 4</option><option value="5">Level 5</option></select></div>
            <div><label><input type="checkbox" id="t-anskeys" checked> Include Teacher Answer Keys?</label></div>
            <div class="actions"><button id="t-gen" class="primary">Generate Test</button><button id="t-copy">Copy HTML</button><div id="t-status" class="status"></div></div>
        </div>
        <div id="t-output" class="output-container"><p>Your generated test will appear here...</p></div>
    </div>
</div>

<script>
"use strict";
(function(){
    const $ = (id) => document.getElementById(id);
    const API_URL = "/api/index"; 
    
    // --- Main App Setup & Tab Switching ---
    (function initTabs(){
        const tabs = document.querySelectorAll('.fcs-tab-btn');
        const generators = document.querySelectorAll('.fcs-generator');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetId = tab.id.replace('tab-', 'gen-');
                tabs.forEach(t => t.classList.remove('primary'));
                tab.classList.add('primary');
                generators.forEach(gen => gen.style.display = 'none');
                $(targetId).style.display = 'block';
            });
        });
    })();

    // --- CORE AI CALL FUNCTION ---
    async function generateResult(prompt, buttonEl, statusEl, outputEl) {
        buttonEl.disabled = true;
        statusEl.textContent = "Generating... Contacting AI...";
        outputEl.innerHTML = "<h4>Please wait. The AI is crafting your content. This can take up to a minute...</h4>";

        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ prompt: prompt })
            });

            const result = await response.json();
            if (!response.ok) throw new Error(result.details || result.error || "An unknown server error occurred.");
            
            outputEl.innerHTML = result.content;
            statusEl.textContent = "Generation successful!";
        } catch (error) {
            console.error("Generation Error:", error);
            outputEl.innerHTML = `<p style="color:red;"><strong>Error:</strong> Failed to generate content. Details: ${error.message}</p>`;
            statusEl.textContent = "An error occurred.";
        } finally {
            buttonEl.disabled = false;
        }
    }

    // --- COPY HELPER ---
    function copyToClipboard(outputEl, statusEl) {
        if (!outputEl.innerHTML || outputEl.innerText.includes("...will appear here...")) { 
            statusEl.textContent = "Nothing to copy."; return; 
        }
        navigator.clipboard.writeText(outputEl.innerHTML).then(
            () => { statusEl.textContent = "Copied to clipboard!"; },
            () => { statusEl.textContent = "Copy failed."; }
        );
    }
    
    // --- VOCABULARY GENERATOR LOGIC ---
    (function setupVocab() {
        const genBtn = $('v-gen'), copyBtn = $('v-copy'), statusEl = $('v-status'), outputEl = $('v-output');
        const levelEl=$("v-level"), tmodeEl=$("v-tmode"), tminEl=$("v-tmin"), tmaxEl=$("v-tmax"), presetTextEl = $("v-presetText");
        const presetRanges={"1":{min:35,max:55},"2":{min:60,max:85},"3":{min:90,max:120},"4":{min:120,max:180},"5":{min:160,max:240}};
        const levelTexts={"1":"Level 1 — Survival","2":"Level 2 — Beginner","3":"Level 3 — Intermediate","4":"Level 4 — Conversational","5":"Level 5 — Fluent"};
        
        function updateUI(){
            const isCustom=tmodeEl.value==='custom'; const range=presetRanges[levelEl.value];
            tminEl.disabled=!isCustom; tmaxEl.disabled=!isCustom;
            if(!isCustom){ tminEl.value=range.min; tmaxEl.value=range.max; }
            presetTextEl.textContent = `Preset for ${levelTexts[levelEl.value]}: ${range.min}–${range.max} words.`;
        }
        tmodeEl.addEventListener('change', updateUI);
        levelEl.addEventListener('change', updateUI);
        
        genBtn.addEventListener('click', () => {
            const topicEl = $("v-topic");
            if(!topicEl.value.trim()){ statusEl.textContent = "Please enter a topic."; return; }
            // This prompt is a direct implementation of your provided rules
            const prompt = `OUTPUT CONTRACT: Produce a COMPLETE, EXCEL-READY VOCABULARY LESSON as a single HTML file with embedded styles, following ALL rules from the FCS Vocabulary Creator documentation. Key Rules: Calibri font. English bold blue (.en), Spanish bold red (.es). Nouns/Verbs/Descriptives MUST be full sentences with the vocab term wrapped in the correct span. All sections alphabetized by English. Adhere strictly to word counts and level grammar ranges. Produce ONE downloadable .html file (no commentary before/after). The user does NOT want markdown, they want a final, usable HTML file. Here is the User Input:\n\n`
             + `Topic: ${topicEl.value}\nLevel: ${levelEl.value}\nTotal Words Mode: ${tmodeEl.value}\nMin Words: ${tminEl.value}\nMax Words: ${tmaxEl.value}`;
            generateResult(prompt, genBtn, statusEl, outputEl);
        });
        copyBtn.addEventListener('click', () => copyToClipboard(outputEl, statusEl));
        updateUI();
    })();
    
    // --- CONVERSATION GENERATOR LOGIC ---
    (function setupConvo() {
        const genBtn = $('c-gen'), copyBtn = $('c-copy'), statusEl = $('c-status'), outputEl = $('c-output');
        genBtn.addEventListener('click', () => {
            const topicEl = $('c-topic');
            if(!topicEl.value.trim()){ statusEl.textContent = "Please enter a topic."; return; }
            const prompt = `OUTPUT CONTRACT: Create content for the Fast Conversational Spanish program. Produce one or more conversations and optionally Fill-in-the-Blank exercises, delivered as a single HTML file with embedded styles. Follow ALL rules from the FCS Conversation Creator documentation. Key Rules: Return ONLY raw HTML. Use specified grammar for the level. Format conversations and practices in two columns (English/Spanish), side-by-side. Bold vocabulary and color it blue (.en) and red (.es). For Fill-in-the-Blank, use ________ (ENGLISH WORD TO TRANSLATE) format. Here is the User Input:\n\n`
             + `Topic: ${topicEl.value}\nLevel: ${$('c-level').value}\nVocabulary List: ${$('c-vocab').value||"auto"}\nNum Convos: ${$('c-numConvos').value}\nNum Speakers: ${$('c-numSpeakers').value}\nAdd FIB: ${$('c-addFib').value}\nFIB Focus: ${$('c-fibFocus').value}\nTone: ${$('c-tone').value}`;
            generateResult(prompt, genBtn, statusEl, outputEl);
        });
        copyBtn.addEventListener('click', () => copyToClipboard(outputEl, statusEl));
    })();

    // --- TEST GENERATOR LOGIC ---
    (function setupTest() {
        const genBtn = $('t-gen'), copyBtn = $('t-copy'), statusEl = $('t-status'), outputEl = $('t-output');
        genBtn.addEventListener('click', () => {
            const vocabEl = $('t-vocab');
            if(!vocabEl.value.trim()){ statusEl.textContent = "Please paste a vocabulary list."; return; }
            const prompt = `OUTPUT CONTRACT: Create a 3-part Spanish test. Produce the output as a single HTML file with embedded styles. Follow ALL rules from the FCS Test Creator documentation precisely. Key Rules: Return ONLY raw HTML. Use only the provided vocabulary. Use only grammar from the specified level. Structure is Part 1 (ES->EN), Part 2 (EN->ES), Part 3 (Oral Prompts). Include answer keys at the very end if requested. Here is the User Input:\n\n`
             + `Level: ${$('t-level').value}\nInclude Answer Keys: ${$('t-anskeys').checked}\nVocabulary List:\n${vocabEl.value}`;
            generateResult(prompt, genBtn, statusEl, outputEl);
        });
        copyBtn.addEventListener('click', () => copyToClipboard(outputEl, statusEl));
    })();

    // Init the app
    initializeControls();
})();
</script>
</body>
</html>
